{
  "name": "caylent-devcontainer",
  "remoteUser": "vscode",
  "image": "mcr.microsoft.com/devcontainers/base:noble",
  "workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",
  "features": {
    "ghcr.io/devcontainers/features/aws-cli:1": {
      "version": "latest"
    },
    "ghcr.io/devcontainers/features/kubectl-helm-minikube:1": {
      "version": "latest"
    },
    "ghcr.io/devcontainers/features/common-utils:2": {
      "version": "latest"
    },
    "ghcr.io/devcontainers/features/docker-in-docker:2": {
      "version": "latest"
    }
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "amazonwebservices.amazon-q-vscode",
        "aws-scripting-guy.cform",
        "amazonwebservices.aws-toolkit-vscode",
        "cschlosser.doxdocgen",
        "eamodio.gitlens",
        "GitHub.copilot",
        "GitHub.copilot-chat",
        "GitHub.vscode-pull-request-github",
        "GitHub.vscode-github-actions",
        "ms-azuretools.vscode-docker",
        "ms-python.debugpy",
        "charliermarsh.ruff",
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-vscode.makefile-tools",
        "redhat.vscode-yaml",
        "streetsidesoftware.code-spell-checker",
        "wayou.vscode-todo-highlight",
        "wholroyd.jinja"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "gitlens.currentLine.enabled": false,
        "gitlens.codeLens.enabled": false,
        "gitlens.hovers.enabled": false,
        "gitlens.statusBar.enabled": false,
        "gitlens.blame.line.enabled": false,
        "gitlens.blame.file.enabled": false,
        "python.defaultInterpreterPath": "/home/vscode/.asdf/installs/python/${env:DEFAULT_PYTHON_VERSION}/bin/python",
        "python.linting.enabled": true,
        "python.defaultFormatter": "charliermarsh.ruff",
        "[python]": {
          "editor.defaultFormatter": "charliermarsh.ruff",
          "editor.codeActionsOnSave": {
            "source.fixAll.ruff": "explicit",
            "source.organizeImports.ruff": "explicit"
          }
        },
        "editor.formatOnSave": true,
        "files.associations": {
          "*.yml": "yaml",
          "*.yaml": "yaml",
          "Dockerfile*": "dockerfile",
          "*.sql": "sql"
        },
        "makefile.extensionOutputFolder": ".vscode",
        "docker.attachShellCommand.linuxContainer": "/bin/bash"
      }
    }
  },
  "forwardPorts": [
    5678
  ],
  "portsAttributes": {
    "5678": {
      "label": "Python Debug (debugpy)"
    }
  },
  "userEnvProbe": "loginInteractiveShell",
  "containerEnv": {
    "AWS_CONFIG_ENABLED": "${localEnv:AWS_CONFIG_ENABLED}",
    "CICD": "${localEnv:CICD}",
    "DEFAULT_GIT_BRANCH": "${localEnv:DEFAULT_GIT_BRANCH}",
    "DEFAULT_PYTHON_VERSION": "${localEnv:DEFAULT_PYTHON_VERSION}",
    "DEVELOPER_NAME": "${localEnv:DEVELOPER_NAME}",
    "DEVCONTAINER": "true",
    "EXTRA_APT_PACKAGES": "${localEnv:EXTRA_APT_PACKAGES}",
    "GIT_PROVIDER_URL": "${localEnv:GIT_PROVIDER_URL}",
    "GIT_TOKEN": "${localEnv:GIT_TOKEN}",
    "GIT_USER": "${localEnv:GIT_USER}",
    "GIT_USER_EMAIL": "${localEnv:GIT_USER_EMAIL}",
    "PAGER": "${localEnv:PAGER}",
    "AWS_DEFAULT_OUTPUT": "${localEnv:AWS_DEFAULT_OUTPUT}",
    "BASH_ENV": "${containerWorkspaceFolder}/shell.env"
  },
  "postCreateCommand": "bash -c 'exec > >(tee /tmp/devcontainer-setup.log) 2>&1; if uname -r | grep -i microsoft > /dev/null; then sudo apt-get update && sudo apt-get install -y gettext-base jq python3 && find .devcontainer -type f -exec sed -i \"s/\\r$//\" {} + && python3 .devcontainer/fix-line-endings.py && sudo apt-get remove -y python3 && sudo apt-get autoremove -y && source shell.env && exec bash .devcontainer/.devcontainer.postcreate.sh vscode; else sudo apt-get update && sudo apt-get install -y gettext-base jq && sudo bash .devcontainer/.devcontainer.postcreate.sh vscode; fi && echo \"Setup complete. View logs: cat /tmp/devcontainer-setup.log\" && exit 0'"
}
